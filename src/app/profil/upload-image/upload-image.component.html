<form (ngSubmit)="closeAndSubmit()">
    <a href="#" (click)="displayLoadPictureModal()">
        <div class="imageContainer">
            <img class="imgProfil" (mouseout)="setIsPictureHover(false)" (mouseover)="setIsPictureHover(true)" [src]="srcProfil" [alt]="ariaDescr" />
            @if (isPictureHover) {
                <div class="pictureHover"></div> 
                <div class="labelUploadPictureProfil" (mouseout)="setIsPictureHover(false)" (mouseover)="setIsPictureHover(true)">
                    <span (mouseout)="setIsPictureHover(false)" (mouseover)="setIsPictureHover(true)"><i class="fa-solid fa-upload"></i></span>
                    <br />
                    <span (mouseout)="setIsPictureHover(false)" (mouseover)="setIsPictureHover(true)" >Upload une image ...</span>
                </div>
            }
        </div>
    </a>
    @if (visible) {
        <!--<p-dialog header="Edit Profile" [modal]="true"  class="modalUploadPictureProfil"> -->
            <p-fileupload #fileUpload class="modalUploadPictureProfil"  url='https://ressources-laroute.ddns.net:8080/image/' name="file" [headers]="headers" [multiple]="false" accept="image/*" maxFileSize="50000000" (onUpload)="onTemplatedUpload($event)" (onBeforeUpload)="onBeforeUpload($event)" (onSelect)="onSelectedFiles($event)" (onProgress)="onProgress($event)">
                <!-- I tried exposing the internal file input -->
                <ng-template pTemplate="content">
                    <input
                    #fileInput
                    type="file"
                    (change)="fileUpload.onFileSelect($event)"
                    style="display: none"
                    />
                </ng-template>
                <ng-template #header let-files let-chooseCallback="chooseCallback" let-clearCallback="clearCallback" let-uploadCallback="uploadCallback">
                    <div class="flex flex-wrap justify-between items-center gap-4">
                        <div class="flex gap-2">
                            <p-button (onClick)="choose($event, chooseCallback)" icon="pi pi-images" [rounded]="true" [outlined]="true" />
                            <p-button (onClick)="uploadEvent(uploadCallback)" icon="pi pi-cloud-upload" [rounded]="true" [outlined]="true" severity="success" [disabled]="!files || files.length === 0" />
                            <p-button (onClick)="clearCallback()" icon="pi pi-trash" [rounded]="true" [outlined]="true" severity="danger" [disabled]="!files || files.length === 0" />
                            <p-button (onClick)="closeAndSubmit()" icon="pi pi-times" [rounded]="true" [outlined]="true" severity="danger" />
                        </div>
                        <p-progressbar [value]="progress" [showValue]="false" class="w-full" styleClass="md:w-20rem h-1 w-full md:ml-auto">
                            <span class="whitespace-nowrap">{{ totalSize }}B / 1Mb</span>
                        </p-progressbar>
                    </div>
                </ng-template>
                <ng-template #content let-files let-uploadedFiles="uploadedFiles" let-removeFileCallback="removeFileCallback" let-removeUploadedFileCallback="removeUploadedFileCallback">
                    <div class="flex flex-col gap-8 pt-4">
                        @if (files?.length == 1) {
                            <div>
                                <h5>Pending</h5>
                                <div class="flex flex-wrap gap-4">
                                    <div class="p-8 rounded-border flex flex-col border border-surface items-center gap-4">
                                        <div>
                                            <img role="presentation" [alt]="files[0].name" [src]="files[0].objectURL" width="100" height="50" />
                                        </div>
                                        <span class="font-semibold text-ellipsis max-w-60 whitespace-nowrap overflow-hidden">{{ files[0].name }}</span>
                                        <div>{{ formatSize(files[0].size) }}</div>
                                        <p-badge value="Pending" severity="warn" />
                                        <p-button icon="pi pi-trash" (click)="onRemoveTemplatingFile($event, files[0], removeFileCallback)" [outlined]="true" [rounded]="true" severity="danger" />
                                    </div>
                                    <p-floatlabel variant="on">
                                        <textarea pTextarea name="on_label_picture_profil" id="on_label_picture_profil" [(ngModel)]="ariaDescr" rows="10" cols="60" style="resize: none" class="h-full"></textarea>
                                        <label class="label_picture_profil" for="on_label_picture_profil">Description de l'image pour les mal voyants et non voyants</label>
                                    </p-floatlabel>                
                                </div>
                            </div>
                        }
                        @if (uploadedFiles?.length > 0) {
                            <div>
                                <h5>Completed</h5>
                                <div class="flex flex-wrap gap-4">
                                    @for (file of uploadedFiles; track index) {
                                        <div  class="card m-0 px-12 flex flex-col border border-surface items-center gap-4">
                                            <div>
                                                <img role="presentation" [alt]="file.name" [src]="file.objectURL" width="100" height="50" />
                                            </div>
                                            <span class="font-semibold text-ellipsis max-w-60 whitespace-nowrap overflow-hidden">{{ file.name }}</span>
                                            <div>{{ formatSize(file.size) }}</div>
                                            <p-badge value="Completed" class="mt-4" severity="success" />
                                            <p-button icon="pi pi-trash" (onClick)="removeUploadedFileCallback(index)" [outlined]="true" [rounded]="true" severity="danger" />
                                        </div>
                                    }
                                </div>
                                <label class="label_picture_profil">Merci, vous avez d√©crit l'image comme :<br />{{ariaDescr}} </label>
                            </div>
                        }
                        
                    </div>
                </ng-template>
                <ng-template #file></ng-template>
                <ng-template #empty>
                    <div class="flex items-center justify-center flex-col">
                        <i class="pi pi-cloud-upload !border-2 !rounded-full !p-8 !text-4xl !text-muted-color"></i>
                        <p class="mt-6 mb-0">Drag and drop files to here to upload.</p>
                    </div>
                    <p-floatlabel variant="on">
                        <textarea pTextarea id="on_label_picture_profil" name="on_label_picture_profil" [(ngModel)]="ariaDescr" rows="10" cols="60" style="resize: none" class="h-full"></textarea>
                        <label class="label_picture_profil" for="on_label_picture_profil">Description de l'image pour les mal voyants et non voyants</label>
                    </p-floatlabel>
                </ng-template>
            </p-fileupload>
        <!--</p-dialog>-->
    }
</form>
